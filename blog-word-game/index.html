<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thanksgiving ‚úàÔ∏è Airlift ‚Äî Word Games</title>
<style>
  :root{--bg:#0f172a;--panel:#111827;--ink:#e5e7eb;--muted:#9ca3af;--accent:#f59e0b;--aviation:#38bdf8;--card:#0b1223}
  *{box-sizing:border-box}html,body{margin:0;height:100%;background:linear-gradient(180deg,#0b1022,#0a1330)}
  body{color:var(--ink);font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;justify-content:center}
  .wrap{width:100%;max-width:980px;padding:16px}
  .app{background:var(--panel);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(90deg,#0a142a,#0b1c3e)}
  header h1{margin:0;font-size:18px;display:flex;gap:10px;align-items:center}
  .badge{background:rgba(34,197,94,.18);color:#22c55e;padding:3px 8px;border-radius:999px;font-size:12px}
  nav.tabs{display:flex;gap:8px}
  nav.tabs button{background:#0c1630;border:1px solid #1f2b47;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  nav.tabs button.active{background:var(--aviation);border-color:var(--aviation);color:#00111b;font-weight:700}
  .content{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:16px}
  @media (max-width:860px){.content{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid #1a2441;border-radius:16px;padding:14px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .kv{display:flex;gap:8px;align-items:center;font-variant-numeric:tabular-nums}
  .kv strong{font-size:18px}
  .hint{color:var(--muted);font-size:13px}
  .grid{display:grid;gap:8px;user-select:none}
  .grid.size-4{grid-template-columns:repeat(4,1fr)}
  .grid.size-5{grid-template-columns:repeat(5,1fr)}
  .tile{aspect-ratio:1/1;background:#101a34;border:1px solid #243150;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800;cursor:pointer;position:relative;transition:transform .05s}
  .tile:active{transform:scale(.98)} .tile.sel{outline:2px solid var(--aviation);background:#0c213f}
  .tile .sub{position:absolute;bottom:6px;right:8px;font-size:11px;color:#94a3b8}
  .tile span {
  color: #fff !important;   /* make the letter white */
  text-shadow: 0 0 3px rgba(0,0,0,0.6); /* soft outline for contrast */
}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .btn{background:#0f1d3b;border:1px solid #23345a;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn.primary{background:linear-gradient(180deg,#19a1e6,#1284c1);border-color:#1e6fa1;color:#001018;font-weight:700}
  .btn.good{background:#0d3527;border-color:#146a4e;color:#9af0cf}
  .btn.warn{background:#3a0f0f;border-color:#7a1f1f;color:#ffc3c3}
  .wordbar{display:flex;gap:8px;margin-top:10px;align-items:center;flex-wrap:wrap}
  .wordbar .current{min-height:36px;display:flex;align-items:center;padding:8px 10px;background:#0b1733;border-radius:8px;border:1px solid #203053;font-weight:700}
  .found{display:grid;gap:8px;max-height:360px;overflow:auto;padding-right:4px}
  .found .item{display:flex;justify-content:space-between;gap:10px;padding:6px 8px;background:#0f1c37;border:1px solid #1e2b49;border-radius:10px}
  .tag{font-size:11px;padding:2px 6px;border-radius:999px;border:1px solid #3a4c78;color:#9db6ff}
  .tag.gold{border-color:#856200;color:#ffd77a;background:rgba(251,191,36,.08)}
  .muted{color:#9ca3af}.section-title{margin:0 0 8px 0;font-size:14px;color:#cbd5e1}
  .divider{height:1px;background:#1c2746;margin:10px 0}
  .score{font-size:28px;font-weight:800;color:#d1fae5}
  .share{display:flex;gap:8px;align-items:center}
  .small{font-size:12px}.hidden{display:none !important}
  .ana{display:grid;gap:10px}.ana .big{font-size:26px;letter-spacing:3px;font-weight:800}
  .pill{padding:6px 10px;border:1px solid #27314c;border-radius:999px;background:#0d1731}
  .flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.grow{flex:1}
  input[type="text"]{background:#0b1733;border:1px solid #203053;border-radius:8px;color:var(--ink);padding:8px 10px;width:100%}
  .success{color:#b7fbdc}.fail{color:#fecaca}
  .footer-note{padding:10px 16px;color:#a7b0c3;background:#0c142b;border-top:1px solid #1b2646;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="app" role="application" aria-label="Airlift Word Games">
    <header>
      <h1><span id="packName">Thanksgiving ‚úàÔ∏è Airlift</span> <span class="badge">Daily</span></h1>
      <nav class="tabs" aria-label="Game modes">
        <button class="tab active" data-tab="grid" aria-pressed="true">Runway Rumble</button>
        <button class="tab" data-tab="anagram" aria-pressed="false">Luggage Tag Shuffle</button>
      </nav>
    </header>

    <section id="grid" class="content">
      <div class="card">
        <div class="row">
          <div class="kv"><span class="hint">Puzzle</span> <strong id="puzzleId">‚Äî</strong></div>
          <div class="kv"><span class="hint">Timer</span> <strong id="timer">2:00</strong></div>
          <div class="kv"><span class="hint">Score</span> <strong class="score" id="score">0</strong></div>
          <label class="pill"><input type="checkbox" id="hard"> 5√ó5 Pro</label>
          <button class="btn" id="reshuffle" title="New daily seed at midnight">Reseed</button>
        </div>
        <div id="gridWrap" class="grid size-4" style="margin-top:12px"></div>
        <div class="wordbar">
          <div class="current" id="currentWord" aria-live="polite"></div>
          <button class="btn primary" id="submitWord">Submit</button>
          <button class="btn" id="backspace">Backspace</button>
          <button class="btn warn" id="clearSel">Clear</button>
        </div>
        <div class="controls">
          <button class="btn good" id="startBtn">Start (2:00)</button>
          <button class="btn" id="hintBtn">Hint</button>
          <span class="hint">Bonus √ó1.5 for ‚úàÔ∏è/ü¶É words. Words ‚â• 3 letters.</span>
        </div>
      </div>

      <aside class="card">
        <h3 class="section-title">Found words</h3>
        <div id="foundList" class="found" aria-live="polite"></div>
        <div class="divider"></div>
        <div class="row share">
          <button class="btn" id="shareBtn">Share</button>
          <span class="small muted" id="shareMsg" aria-live="polite"></span>
        </div>
        <div class="divider"></div>
        <div>
          <h3 class="section-title">High scores</h3>
          <div class="row small"><span class="pill">Today:</span> <strong id="bestToday">0</strong></div>
          <div class="row small"><span class="pill">All-time:</span> <strong id="bestAll">0</strong></div>
        </div>
      </aside>
    </section>

    <section id="anagram" class="content hidden" aria-hidden="true">
      <div class="card">
        <div class="row">
          <div class="kv"><span class="hint">Round</span> <strong id="anaRound">1 / 10</strong></div>
          <div class="kv"><span class="hint">Timer</span> <strong id="anaTimer">1:00</strong></div>
          <div class="kv"><span class="hint">Score</span> <strong class="score" id="anaScore">0</strong></div>
          <button class="btn" id="anaStart">Start (1:00)</button>
        </div>
        <div class="divider"></div>
        <div class="ana">
          <div class="big" id="scramble">‚Äî</div>
          <div class="hint" id="clue">Clue appears here.</div>
          <div class="flex">
            <input id="anaInput" type="text" autocomplete="off" placeholder="Type your answer‚Ä¶" class="grow" />
            <button class="btn primary" id="anaSubmit">Submit</button>
            <button class="btn" id="anaSkip">Skip</button>
          </div>
          <div id="anaFeedback" class="small muted"></div>
        </div>
      </div>

      <aside class="card">
        <h3 class="section-title">How it works</h3>
        <p class="small">Unscramble the letters to match the clue. Mix of airport codes, aviation, and holiday terms. Streaks add bonus points.</p>
        <div class="divider"></div>
        <h3 class="section-title">Streak</h3>
        <div class="row"><span class="pill">Current:</span> <strong id="anaStreak">0</strong></div>
        <div class="row"><span class="pill">Best:</span> <strong id="anaBestStreak">0</strong></div>
      </aside>
    </section>

    <div class="footer-note">
      Tip: Host this file and swap packs via <code>?pack=thanksgiving</code> or <code>?pack=christmas</code>, or hardcode a pack URL. You can also embed via Squarespace Code Block using the fragment version below.
    </div>
  </div>
</div>

<script>
/* =============================== */
/* Word Pack Loader + Overrides    */
/* =============================== */

// Defaults (can be overridden by pack)
window.__GRID_TIMER_SEC = 120;
window.__ANA_TIMER_SEC  = 60;
window.__SEED_SALT = "";

// Allow selecting pack via URL:
//  - ?pack=christmas     -> loads ./packs/christmas.json
//  - ?packUrl=https://...json  -> loads that URL directly
const urlParams = new URL(location.href).searchParams;
const packParam = urlParams.get('pack');     // e.g., "thanksgiving" or "christmas"
const packUrlParam = urlParams.get('packUrl');
const PACK_BASE = 'packs/';                  // folder under your site root when hosting
let WORDPACK_URL = '';                       // set below

if (packUrlParam) {
  WORDPACK_URL = packUrlParam;
} else if (packParam) {
  WORDPACK_URL = PACK_BASE + packParam + '.json';
} else {
  WORDPACK_URL = PACK_BASE + 'thanksgiving.json'; // default
}

let PACK = null;

async function loadWordPack() {
  if (!WORDPACK_URL) return null;
  try {
    const res = await fetch(WORDPACK_URL, { mode: 'cors', cache: 'no-cache' });
    if (!res.ok) throw new Error(res.status + " " + res.statusText);
    return await res.json();
  } catch (e) {
    console.warn("Word pack load failed; using built-ins:", e);
    return null;
  }
}

function applyWordPack(pack) {
  if (!pack) return;

  // Title
  if (pack.meta && pack.meta.name) {
    document.getElementById('packName').textContent = pack.meta.name;
  }

  // Settings
  if (pack.settings) {
    if (typeof pack.settings.gridTimerSec === 'number') window.__GRID_TIMER_SEC = pack.settings.gridTimerSec;
    if (typeof pack.settings.anagramTimerSec === 'number') window.__ANA_TIMER_SEC = pack.settings.anagramTimerSec;
    if (pack.settings.seedSalt) window.__SEED_SALT = String(pack.settings.seedSalt);
  }

  // Grid words
  if (pack.grid) {
    if (Array.isArray(pack.grid.core_words)) {
      CORE_WORDS.clear();
      pack.grid.core_words.forEach(w => CORE_WORDS.add(String(w).toLowerCase()));
    }
    if (Array.isArray(pack.grid.golden_words)) {
      GOLDEN_WORDS.clear();
      pack.grid.golden_words.forEach(w => GOLDEN_WORDS.add(String(w).toLowerCase()));
    }
    if (Array.isArray(pack.grid.iata)) {
      IATA.splice(0, IATA.length, ...pack.grid.iata.map(x => String(x).toUpperCase()));
      IATA.forEach(c => CORE_WORDS.add(c.toLowerCase()));
    }
    if (Array.isArray(pack.grid.letter_bag) && pack.grid.letter_bag.length) {
      LETTER_BAG.splice(0, LETTER_BAG.length, ...pack.grid.letter_bag.map(ch => String(ch).toUpperCase()));
    }
  }

  // Anagrams
  if (Array.isArray(pack.anagrams) && pack.anagrams.length) {
    ANA_ROUNDS.splice(0, ANA_ROUNDS.length,
      ...pack.anagrams.map(r => ({
        answer: String(r.answer || "").toUpperCase(),
        clue: String(r.clue || ""),
        letters: String(r.letters || "")
      }))
    );
  }
}

/* =============================== */
/* Core helpers (unchanged)        */
/* =============================== */
const tzOffsetMinutes = new Date().getTimezoneOffset();
function yyyymmddKey(d=new Date()){
  const dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  return dt.toISOString().slice(0,10);
}
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296;}}
function seededFromDate(extra=0){
  const k = yyyymmddKey() + (window.__SEED_SALT || "");
  let h=2166136261>>>0; for (let i=0;i<k.length;i++){h^=k.charCodeAt(i);h=Math.imul(h,16777619);} h=(h+extra)>>>0;
  return mulberry32(h);
}
function randChoice(rng, arr){return arr[Math.floor(rng()*arr.length)]}
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* =============================== */
/* Dictionaries (fallback defaults)*/
/* =============================== */
const GOLDEN_WORDS = new Set([
  "turkey","gravy","stuffing","cranberry","pumpkin","pie","family","thanks","thankful","gratitude","harvest","leftovers",
  "boarding","pushback","deice","de-ice","atis","notam","ils","queue","taxi","apron","gate","gatehold","slots","hub","layover","cabin","crew","runway","tower","radar","flare","final","rotate","vector","hold","ifr","vfr","squawk","pilot","captain","copilot","fa","rwy"
]);
const IATA = ["ATL","ORD","DFW","DEN","LAX","JFK","EWR","BOS","IAD","DCA","MCO","PHX","CLT","MSP","SFO","SEA","MIA","BWI","DTW","FLL","TPA","IAH","SLC","SAN","PDX","LAS","PHL","AUS"];
const CORE_WORDS = new Set(["air","run","way","gate","bag","tag","fly","pilot","crew","seat","meal","line","queue","flare","final","hold","note","ice","deice","taxi","apron","fast","slow","thank","thanks","thankful","family","gravy","turkey","pie","pumpkin","yams","meal","stuff","stuffing","serve","table","plate","fork","spoon","leftovers","home","visit","host","guest","fall","autumn","harvest","corn","squash","apple","cider"]);
IATA.forEach(c=>CORE_WORDS.add(c.toLowerCase()));
const LETTER_BAG = [
  ..."EEEEEEEEEEEE", ..."AAAAAAAAA", ..."IIIIIIIII", ..."OOOOOOOO",
  ..."NNNNNN","RRRRRR","TTTTTT","LLLLL","SSSSS","DDDDD","GGGG","UUUU","HHHH","CCCC","MMM",
  "B","P","F","Y","W","K","V","J","X","Z","Q",
  ..."RUNWAYTHANKSAVIONTURKEYPIEBOARDGATEHOLD"
];
const ANA_ROUNDS = [
  {answer:"JFK", clue:"NYC Thanksgiving traffic (IATA)", letters:"KJF"},
  {answer:"TURKEY", clue:"Centerpiece of many tables", letters:"UETKRY"},
  {answer:"GATE", clue:"Where boarding begins", letters:"GT AE"},
  {answer:"GRAVY", clue:"Pours over potatoes", letters:"VGYRA"},
  {answer:"NOTAM", clue:"Pilots are thankful for timely‚Ä¶", letters:"MTOAN"},
  {answer:"LAYOVER", clue:"An unexpected holiday in a hub", letters:"RLYOAVE"},
  {answer:"PIE", clue:"Pumpkin or apple", letters:"EIP"},
  {answer:"DEICE", clue:"Cold-weather ground operation", letters:"ECEDI"},
  {answer:"ATL", clue:"Busiest US airport overall", letters:"TLA"},
  {answer:"FAMILY", clue:"Reason for the season", letters:"MALYIF"}
];

/* =============================== */
/* Tabs                            */
/* =============================== */
$$('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.tab').forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-pressed','false')});
    btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
    const tab = btn.dataset.tab;
    if(tab==='grid'){ $('#grid').classList.remove('hidden'); $('#anagram').classList.add('hidden'); $('#anagram').setAttribute('aria-hidden','true'); }
    else { $('#anagram').classList.remove('hidden'); $('#grid').classList.add('hidden'); $('#anagram').setAttribute('aria-hidden','false'); }
  });
});

/* =============================== */
/* Mode A: Word Grid               */
/* =============================== */
let gridSize=4,rng=seededFromDate(0),tiles=[],selection=[],found=new Set(),running=false,timeLeft=120,timerId=null,score=0;
const LSKEY="tgx_airlift_scores";const todayKey=yyyymmddKey();
function loadScores(){try{return JSON.parse(localStorage.getItem(LSKEY)||"{}")}catch(e){return {}}}
function saveScores(bt,ba){const o=loadScores();o.bestAll=Math.max(ba,o.bestAll||0);o.bestByDay=o.bestByDay||{};o.bestByDay[todayKey]=Math.max(bt,o.bestByDay[todayKey]||0);localStorage.setItem(LSKEY,JSON.stringify(o))}
function updateScoreboard(){const o=loadScores();$('#bestToday').textContent=(o.bestByDay&&o.bestByDay[todayKey])||0;$('#bestAll').textContent=o.bestAll||0}
function makeGrid(){const wrap=$('#gridWrap');wrap.innerHTML='';wrap.classList.toggle('size-5',gridSize===5);wrap.classList.toggle('size-4',gridSize===4);tiles=[];const count=gridSize*gridSize;for(let i=0;i<count;i++){const ch=randChoice(rng,LETTER_BAG);const tile=document.createElement('button');tile.className='tile';tile.setAttribute('aria-label',`Letter ${ch}`);tile.dataset.index=i;tile.dataset.letter=ch.toLowerCase();tile.innerHTML=`<span>${ch}</span><span class="sub">${i+1}</span>`;tile.addEventListener('click',()=>toggleSelect(i));tiles.push(tile);wrap.appendChild(tile)}selection=[];updateCurrentWord()}
function indexNeighbors(i){const n=[];const r=Math.floor(i/gridSize);const c=i%gridSize;for(let dr=-1;dr<=1;dr++){for(let dc=-1;dc<=1;dc++){if(dr===0&&dc===0)continue;const rr=r+dr,cc=c+dc;if(rr>=0&&rr<gridSize&&cc>=0&&cc<gridSize)n.push(rr*gridSize+cc)}}return n}
function toggleSelect(i){if(!running)return;if(selection.length===0){selection=[i];tiles[i].classList.add('sel');updateCurrentWord();return}const last=selection[selection.length-1];if(selection.includes(i)){if(i===last){selection.pop();tiles[i].classList.remove('sel');updateCurrentWord()}return}const neighbors=indexNeighbors(last);if(neighbors.includes(i)){selection.push(i);tiles[i].classList.add('sel');updateCurrentWord()}}
function currentWordStr(){return selection.map(i=>tiles[i].dataset.letter).join('')}
function clearSelection(){selection.forEach(i=>tiles[i].classList.remove('sel'));selection=[];updateCurrentWord()}
function backspaceSelection(){const i=selection.pop();if(i!=null)tiles[i].classList.remove('sel');updateCurrentWord()}
function wordScore(w){let pts=w.length;if(w.length>=5)pts+=2;let mult=1;if(GOLDEN_WORDS.has(w)||IATA.includes(w.toUpperCase()))mult=1.5;return Math.round(pts*mult)}
function acceptWord(w){if(found.has(w))return{ok:false,msg:"Already found."};if(!isValidWord(w))return{ok:false,msg:"Not in word list."};found.add(w);const pts=wordScore(w);score+=pts;$('#score').textContent=score;renderFound();return{ok:true,pts}}
function isValidWord(w){if(w.length<3)return false;if(CORE_WORDS.has(w))return true;if(IATA.includes(w.toUpperCase()))return true;if(GOLDEN_WORDS.has(w))return true;return false}
function renderFound(){const box=$('#foundList');box.innerHTML='';const items=Array.from(found).sort((a,b)=>b.length-a.length||a.localeCompare(b));for(const w of items){const row=document.createElement('div');row.className='item';const isGold=GOLDEN_WORDS.has(w)||IATA.includes(w.toUpperCase());row.innerHTML=`<span>${w.toUpperCase()}</span><span class="tag ${isGold?'gold':''}">${wordScore(w)} pts</span>`;box.appendChild(row)}}
function updateCurrentWord(){$('#currentWord').textContent=currentWordStr().toUpperCase()}
function startTimer(){running=true;timeLeft=window.__GRID_TIMER_SEC;$('#startBtn').disabled=true;tickGridTimer()}
function tickGridTimer(){const m=Math.floor(timeLeft/60),s=timeLeft%60;$('#timer').textContent=`${m}:${s.toString().padStart(2,'0')}`;if(timeLeft<=0){running=false;$('#startBtn').disabled=false;const o=loadScores();const bt=Math.max(score,(o.bestByDay&&o.bestByDay[todayKey])||0);const ba=Math.max(score,o.bestAll||0);saveScores(bt,ba);updateScoreboard();return}timeLeft--;timerId=setTimeout(tickGridTimer,1000)}
function reseed(){rng=seededFromDate(Math.floor(Math.random()*1e9)>>>0);makeGrid();resetRound()}
function resetRound(){found.clear();renderFound();score=0;$('#score').textContent=score;clearSelection();if(timerId)clearTimeout(timerId);running=false;$('#startBtn').disabled=false;$('#timer').textContent=formatTime(window.__GRID_TIMER_SEC)}
function formatTime(sec){const m=Math.floor(sec/60),s=sec%60;return `${m}:${s.toString().padStart(2,'0')}`}
document.addEventListener('keydown',(e)=>{if($('#anagram')&&!$('#anagram').classList.contains('hidden'))return;if(!running)return;if(e.key==='Enter'){submitCurrent()}else if(e.key==='Backspace'){e.preventDefault();backspaceSelection()}else if(e.key==='Escape'){clearSelection()}})
function shareText(){const id=$('#puzzleId').textContent;const items=Array.from(found);const tally=items.length;const stars="‚úàÔ∏è".repeat(Math.min(5,Math.max(1,Math.floor(score/20))));const pname=$('#packName').textContent;return [`${pname} ‚Äî Runway Rumble #${id}`,`Score: ${score}  Words: ${tally}  Grid: ${gridSize}√ó${gridSize}  ${stars}`,items.slice(0,10).map(w=>w.toUpperCase()).join(" ¬∑ "), "Play on: "+location.hostname].filter(Boolean).join("\n")}
function randomHint(){const list=[...GOLDEN_WORDS,...IATA.map(x=>x.toLowerCase())];return list[Math.floor(seededFromDate(42)()*list.length)].toUpperCase()}
function initGridMode(){gridSize=$('#hard').checked?5:4;rng=seededFromDate(0);makeGrid();resetRound();$('#puzzleId').textContent=yyyymmddKey().replaceAll('-','')}
$('#hard').addEventListener('change',()=>{gridSize=$('#hard').checked?5:4;initGridMode()});
$('#startBtn').addEventListener('click',()=>startTimer());
$('#reshuffle').addEventListener('click',reseed);
$('#submitWord').addEventListener('click',submitCurrent);
$('#clearSel').addEventListener('click',clearSelection);
$('#backspace').addEventListener('click',backspaceSelection);
$('#hintBtn').addEventListener('click',()=>{const h=randomHint();$('#shareMsg').textContent=`Try to find: ${h}`;setTimeout(()=>$('#shareMsg').textContent='',3000)});
$('#shareBtn').addEventListener('click',async()=>{const txt=shareText();try{await navigator.clipboard.writeText(txt);$('#shareMsg').textContent='Result copied!'}catch(e){$('#shareMsg').textContent='Copy failed ‚Äî select & copy.'}setTimeout(()=>$('#shareMsg').textContent='',4000)});
function submitCurrent(){if(!running)return;const w=currentWordStr();const res=acceptWord(w);$('#shareMsg').textContent=res.ok?`+${wordScore(w)} for ${w.toUpperCase()}`:res.msg;clearSelection();setTimeout(()=>$('#shareMsg').textContent='',1800)}

/* =============================== */
/* Mode B: Anagrams                */
/* =============================== */
let anaIx=0, anaScore=0, anaTimer=0, anaTimerId=null, anaStreak=0, anaBest=0;
function setAnaRound(i){const r=ANA_ROUNDS[i];$('#anaRound').textContent=`${i+1} / ${ANA_ROUNDS.length}`;$('#scramble').textContent=r.letters.replace(/\s+/g,'').toUpperCase();$('#clue').textContent=r.clue;$('#anaInput').value='';$('#anaFeedback').textContent=''}
function startAna(){anaIx=0;anaScore=0;anaStreak=0;$('#anaScore').textContent=anaScore;$('#anaStreak').textContent=anaStreak;setAnaRound(0);startAnaTimer()}
function startAnaTimer(){if(anaTimerId)clearInterval(anaTimerId);anaTimer=window.__ANA_TIMER_SEC;$('#anaTimer').textContent=formatTime(anaTimer);anaTimerId=setInterval(()=>{anaTimer--;$('#anaTimer').textContent=formatTime(anaTimer);if(anaTimer<=0){clearInterval(anaTimerId);anaTimerId=null;$('#anaFeedback').innerHTML=`<span class="fail">Time!</span>`}},1000)}
function anaSubmit(skip=false){if(anaIx>=ANA_ROUNDS.length)return;const r=ANA_ROUNDS[anaIx];const guess=(skip?"":$('#anaInput').value.trim()).toUpperCase();if(skip){$('#anaFeedback').innerHTML=`<span class="muted">Skipped. Answer was <b>${r.answer}</b>.</span>`;anaStreak=0;$('#anaStreak').textContent=anaStreak}else if(guess===r.answer.toUpperCase()){const base=Math.max(3,r.answer.length);anaStreak++;anaBest=Math.max(anaBest,anaStreak);const pts=base+Math.min(5,anaStreak);anaScore+=pts;$('#anaScore').textContent=anaScore;$('#anaStreak').textContent=anaStreak;$('#anaBestStreak').textContent=anaBest;$('#anaFeedback').innerHTML=`<span class="success">+${pts} ‚úì</span>`}else{$('#anaFeedback').innerHTML=`<span class="fail">‚úó Try again</span>`;return}anaIx++;if(anaIx<ANA_ROUNDS.length){setTimeout(()=>setAnaRound(anaIx),500)}else{if(anaTimerId){clearInterval(anaTimerId);anaTimerId=null}$('#anaFeedback').innerHTML+=` <span class="muted">‚Äî Finished! Final: <b>${anaScore}</b></span>`}}
$('#anaStart').addEventListener('click',startAna);
$('#anaSubmit').addEventListener('click',()=>anaSubmit(false));
$('#anaSkip').addEventListener('click',()=>anaSubmit(true));
$('#anaInput').addEventListener('keydown',(e)=>{if(e.key==='Enter')anaSubmit(false)});

/* =============================== */
/* Boot: load pack, then init      */
/* =============================== */
(async () => {
  PACK = await loadWordPack();
  applyWordPack(PACK);
  initGridMode();
  updateScoreboard();
})();
</script>
</body>
</html>
